import L from"leaflet";L.TileLayer.WMTS=L.TileLayer.extend({defaultWmtsParams:{service:"WMTS",request:"GetTile",version:"1.0.0",layer:"",style:"",tilematrixset:"",format:"image/jpeg"},initialize(t,e){this._url=t;const i={};Object.keys(e).forEach(t=>i[t.toLowerCase()]=e[t]);const r=L.extend({},this.defaultWmtsParams),s=i.tileSize||this.options.tileSize;i.detectRetina&&L.Browser.retina?(r.width=2*s,r.height=2*s):(r.width=s,r.height=s);for(const t in i)r.hasOwnProperty(t)&&"matrixIds"!==t&&(r[t]=i[t]);this.wmtsParams=r,this.matrixIds=e.matrixIds||this.getDefaultMatrix(),L.setOptions(this,e)},onAdd(t){this._crs=this.options.crs||t.options.crs,L.TileLayer.prototype.onAdd.call(this,t)},getTileUrl(t){const e=this.options.tileSize,i=t.multiplyBy(e);i.x+=1,i.y-=1;const r=i.add(new L.Point(e,e)),s=this._tileZoom,a=this._crs.project(this._map.unproject(r,s)),o=this._crs.project(this._map.unproject(i,s)),l=a.x-o.x,n=this.matrixIds[s].identifier,h=`${this.wmtsParams.tilematrixset}:${n}`,m=this.matrixIds[s].topLeftCorner.lng,d=this.matrixIds[s].topLeftCorner.lat,p=Math.floor((o.x-m)/l),c=-Math.floor((o.y-d)/l),x=L.Util.template(this._url,{s:this._getSubdomain(t)});return`${x}${L.Util.getParamString(this.wmtsParams,x)}`+`&tilematrix=${h}&tilerow=${c}&tilecol=${p}`},setParams(t,e){return L.extend(this.wmtsParams,t),e||this.redraw(),this},getDefaultMatrix(){const t=new Array(22);for(let e=0;e<22;e++)t[e]={identifier:String(e),topLeftCorner:new L.LatLng(20037508.3428,-20037508.3428)};return t}});export default L.TileLayer.WMTS;